#Deploy config for component
---
apiVersion: v3
deployments:
  - deploy:
      region: bo1
      namespace: cib-mkrt-rates
      image: produban/bwce:2.80.4.RELEASE
      technology: bwce
      runAsUser: 1000
      podName: lxybondmx
      flowLimit: #Enter here the name of component to set flowlimit and the number of thread in parallel, example filepoller:5
        - "ComponentReceiver:5"
      replicas: 1
      resources:
        limits:
          cpu: "500m"
          memory: 1048M
        requests:
          cpu: "150m"
          memory: 1024M
      ports:
        - containerPort: 8080
          protocol: TCP
      env:
        # - name: APP_CONFIG_PROFILE
        #  value: ESDEV
        - name: BW_PROFILE
          value: '''Docker'''
        # - name: SPRING_CLOUD_CONFIG_SERVER_URL
        #  value: '''http://config-service:8080'''
        - name: APP_NAME
          value: lxybondmx
        - name: BW_LOGLEVEL
          value: ERROR
        - name: DISABLE_BWCE_EAR_VALIDATION
          value: '''False'''
        - name: DRIVERS_URL
          value: >-
            https://nexusmaster.alm.europe.cloudcenter.corp/repository/maven-releases/com/santander/cib/mw/common/TIBCOJARS/1.0.0/TIBCOJARS-1.0.0.jar
        - name: THIRD_PARTY_URL
        - name: CERTS_URL
        - name: WILY_MOM_FQDN
        - name: WILY_MOM_PORT
          value: '''5001'''
        - name: TIBCO_PLUG_INS_URL
          value: >-
            https://nexusmaster.alm.europe.cloudcenter.corp/repository/maven-releases/com/santander/cib/mw/common/tibco_plugins/1.0.5/tibco_plugins-1.0.5.zip
        - name: JAVA_OPTS_EXT
          value: -Djava.security.egd=file:/dev/./urandom
        - name: BW_JAVA_OPTS
          value: >-
                -Djava.property.com.tibco.tibjms.reconnect.attempts=6,5000
                -Dbw.engine.enable.memory.saving.mode=true
        - name: BW_APP_MONITORING_CONFIG
        - name: BW_COMPONENT_JOB_FLOWLIMIT
          value: '8'
        - name: CUSTOM_LOGBACK_URL
        - name: PROJECT_NAME
        - name: TZ
          value: Europe/Madrid
        - name: BW_ENGINE_THREADCOUNT
          value: '4'
        - name: BW_APPLICATION_JOB_FLOWLIMIT
          value: '8'
        - name: JAVA_TOOL_OPTIONS
          value: '-Dfile.encoding=UTF-8'                             
      readinessProbe:
        httpGet:
          path: /health
          port: 8080
          scheme: HTTP
        initialDelaySeconds: 0
        timeoutSeconds: 1
        periodSeconds: 10
        successThreshold: 1
        failureThreshold: 3

services:
  - service:
      region: bo1 
      name: lxybondmx
      namespace: cib-mkrt-rates
      ports:
        - name: http
          protocol: TCP
          port: 8080
          targetPort: 8080

routes:
 - route:
     region: bo1
     name: lxybondmx
     namespace: cib-mkrt-rates
     host: lxybondmx.scib.dev.corp
     to: lxybondmx
     targetPort: http
     secure: false